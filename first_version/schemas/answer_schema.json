{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["status"],
  "properties": {
    "status": {"type": "string", "enum": ["ok", "refuse"]},
    "sql": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["dialect", "statement", "explanation", "evidence", "limits"],
        "properties": {
          "dialect": {"type": "string"},
          "statement": {"type": "string"},
          "explanation": {"type": "string"},
          "evidence": {
            "type": "object",
            "properties": {
              "entities": {"type": "array", "items": {"type": "string"}},
              "measures": {"type": "array", "items": {"type": "string"}},
              "metrics": {"type": "array", "items": {"type": "string"}}
            }
          },
          "limits": {
            "type": "object",
            "properties": {
              "row_limit": {"type": "integer"},
              "timeout_sec": {"type": "integer"}
            }
          }
        }
      }
    },
    "next_steps": {"type": "array", "items": {"type": "string"}},
    "refusal": {
      "type": "object",
      "properties": {
        "reason": {"type": "string"},
        "missing_objects": {"type": "array", "items": {"type": "string"}},
        "clarifying_questions": {"type": "array", "items": {"type": "string"}}
      }
    }
  }
}
